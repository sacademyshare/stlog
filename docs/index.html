<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>映像授業受講状況管理 Webアプリ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <!-- ログイン画面 -->
    <section id="login-view" class="view view--login">
      <div class="login-card">
        <h1 class="app-title">映像授業 受講状況管理</h1>
        <p class="app-subtitle">学習塾用・GitHub運用対応 Webアプリ</p>
        <form id="login-form" class="login-form">
          <label class="form-field">
            <span>ユーザーID</span>
            <input type="text" id="login-id" autocomplete="username" required />
          </label>
          <label class="form-field">
            <span>パスワード</span>
            <input type="password" id="login-password" autocomplete="current-password" required />
          </label>
          <button type="submit" class="btn btn--primary btn--full">ログイン</button>
          <p id="login-error" class="form-error" aria-live="polite"></p>
        </form>
        <details class="login-hint">
          <summary>デモ用ログイン情報</summary>
          <ul>
            <li>管理者: <code>admin / admin123</code></li>
            <li>講師: <code>t001 / teacher123</code></li>
            <li>生徒: <code>S001 / student123</code></li>
          </ul>
        </details>
      </div>
    </section>

    <!-- メインレイアウト -->
    <section id="main-layout" class="layout layout--hidden">
      <header class="app-header">
        <div class="app-header__left">
          <h1 class="app-header__title">映像授業 受講状況管理</h1>
          <span id="data-status" class="badge badge--secondary">データ未読込</span>
        </div>
        <div class="app-header__right">
          <button id="reload-data-btn" class="btn btn--ghost btn--small" title="GitHub上のCSVを再読込">
            再読込
          </button>
          <div class="user-info">
            <span id="user-label" class="user-info__label"></span>
            <button id="logout-btn" class="btn btn--outline btn--small">ログアウト</button>
          </div>
        </div>
      </header>

      <div class="app-body">
        <nav class="app-nav">
          <button class="app-nav__item app-nav__item--active" data-view-target="dashboard">ダッシュボード</button>
          <button class="app-nav__item" data-view-target="students">生徒</button>
          <button class="app-nav__item" data-view-target="courses">講座</button>
          <button class="app-nav__item" data-view-target="calendar">カレンダー</button>
          <button class="app-nav__item" data-view-target="analytics">分析</button>
          <button class="app-nav__item" data-view-target="registration">ユーザー登録</button>
          <button class="app-nav__item" data-view-target="settings">設定</button>
        </nav>

        <main class="app-main">
          <!-- ダッシュボード -->
          <section id="view-dashboard" class="view view--active">
            <h2 class="view-title">ダッシュボード</h2>
            <div class="grid grid--3">
              <div class="card">
                <h3 class="card__title">登録生徒数</h3>
                <p class="metric"><span id="metric-student-count">-</span><span class="metric__unit">名</span></p>
              </div>
              <div class="card">
                <h3 class="card__title">今月の受講コマ数</h3>
                <p class="metric"><span id="metric-monthly-logs">-</span><span class="metric__unit">コマ</span></p>
              </div>
              <div class="card">
                <h3 class="card__title">全体平均達成率</h3>
                <p class="metric"><span id="metric-avg-progress">-</span><span class="metric__unit">%</span></p>
              </div>
            </div>

            <section class="section">
              <header class="section__header">
                <h3>講座別 進捗サマリ</h3>
              </header>
              <div id="dashboard-course-summary" class="table-wrapper small-scroll"></div>
            </section>
          </section>

          <!-- 生徒一覧／詳細（講師・管理者用）／マイページ（生徒用） -->
          <section id="view-students" class="view">
            <h2 class="view-title">生徒</h2>
            <div class="split split--2">
              <!-- 左：生徒一覧（生徒ロールでは非表示） -->
              <div class="split__pane">
                <header class="section__header">
                  <h3>生徒一覧</h3>
                  <div class="section__actions">
                    <input id="student-filter" type="search" class="input input--small" placeholder="ID / コース群でフィルタ" />
                  </div>
                </header>
                <div id="students-table" class="table-wrapper"></div>
              </div>

              <!-- 右：詳細 or マイページ -->
              <div class="split__pane split__pane--detail">
                <header class="section__header">
                  <h3>生徒詳細 / マイページ</h3>
                  <span id="student-detail-label" class="muted">左の一覧から生徒を選択するか、生徒としてログインしてください。</span>
                </header>
                <div id="student-detail" class="student-detail"></div>
              </div>
            </div>
          </section>

          <!-- 講座マスタ -->
          <section id="view-courses" class="view">
            <h2 class="view-title">講座マスタ</h2>
            <section class="section">
              <header class="section__header">
                <h3>講座一覧</h3>
                <div class="section__actions">
                  <button id="download-courses-csv" class="btn btn--outline btn--small">CSVダウンロード</button>
                </div>
              </header>
              <div id="courses-table" class="table-wrapper"></div>
            </section>
          </section>

          <!-- カレンダー（全体） -->
          <section id="view-calendar" class="view">
            <h2 class="view-title">カレンダー</h2>
            <section class="section">
              <header class="section__header">
                <h3>月間カレンダー（全体）</h3>
                <div class="section__actions">
                  <button id="calendar-prev-month" class="btn btn--ghost btn--small">&#9664;</button>
                  <span id="calendar-month-label" class="calendar__month-label"></span>
                  <button id="calendar-next-month" class="btn btn--ghost btn--small">&#9654;</button>
                </div>
              </header>
              <div id="global-calendar" class="calendar"></div>
              <p class="muted small">※ 各日の数字は「全生徒の合計受講コマ数」です。</p>
            </section>
          </section>

          <!-- 分析 -->
          <section id="view-analytics" class="view">
            <h2 class="view-title">分析</h2>
            <section class="section">
              <header class="section__header">
                <h3>生徒別 進捗一覧</h3>
              </header>
              <div id="analytics-student-progress" class="table-wrapper"></div>
            </section>
          </section>

          <!-- ユーザー登録 -->
          <section id="view-registration" class="view">
            <h2 class="view-title">ユーザー登録</h2>
            <section class="section">
              <header class="section__header">
                <h3>新規生徒ユーザー登録</h3>
              </header>
              <form id="registration-form" class="settings-form">
                <div class="form-row">
                  <label class="form-field">
                    <span>生徒ID（student_id）</span>
                    <input type="text" id="reg-student-id" placeholder="S004 など" required />
                  </label>
                  <label class="form-field">
                    <span>学年</span>
                    <input type="text" id="reg-grade" placeholder="J2 / H1 など" required />
                  </label>
                  <label class="form-field">
                    <span>コース群</span>
                    <input type="text" id="reg-course-group" placeholder="高1文系 など" />
                  </label>
                  <label class="form-field">
                    <span>ステータス</span>
                    <select id="reg-status">
                      <option value="active">active</option>
                      <option value="inactive">inactive</option>
                    </select>
                  </label>
                  <label class="form-field">
                    <span>初期パスワード</span>
                    <input type="password" id="reg-password" placeholder="任意の文字列" required />
                  </label>
                </div>
                <button type="submit" class="btn btn--primary btn--small">ユーザー登録</button>
                <p class="muted small">
                  ※ 登録するとブラウザのローカルストレージにログイン情報が作成され、<br/>
                  同時に <code>students</code> データにも追加されます（CSVダウンロードが必要です）。
                </p>
                <p id="registration-message" class="form-message" aria-live="polite"></p>
              </form>
            </section>
          </section>

          <!-- 設定 -->
          <section id="view-settings" class="view">
            <h2 class="view-title">設定</h2>
            <section class="section">
              <header class="section__header">
                <h3>ログイン設定</h3>
              </header>
              <form id="password-form" class="settings-form">
                <div class="form-row">
                  <label class="form-field">
                    <span>現在のパスワード</span>
                    <input type="password" id="current-password" />
                  </label>
                  <label class="form-field">
                    <span>新しいパスワード</span>
                    <input type="password" id="new-password" />
                  </label>
                  <label class="form-field">
                    <span>新しいパスワード（確認）</span>
                    <input type="password" id="new-password-confirm" />
                  </label>
                </div>
                <button type="submit" class="btn btn--primary btn--small">パスワード変更（擬似）</button>
                <p class="muted small">※ 本システムは擬似ログイン方式です。パスワードはブラウザのローカルストレージにのみ保存されます。</p>
                <p id="password-message" class="form-message" aria-live="polite"></p>
              </form>
            </section>

            <section class="section">
              <header class="section__header">
                <h3>CSVエクスポート</h3>
              </header>
              <div class="button-row">
                <button id="download-students-csv" class="btn btn--outline btn--small">students.csv</button>
                <button id="download-student-courses-csv" class="btn btn--outline btn--small">student_courses.csv</button>
                <button id="download-lesson-logs-csv" class="btn btn--outline btn--small">lesson_logs.csv</button>
              </div>
              <p class="muted small">※ ダウンロードしたCSVを管理者PCでGitHubへcommit/pushしてください。</p>
            </section>
          </section>
        </main>
      </div>

      <div id="toast" class="toast toast--hidden" role="status" aria-live="polite"></div>
    </section>
  </div>

  <script src="script.js"></script>
</body>
</html>
